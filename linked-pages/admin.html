<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>预约管理后台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            color: white;
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .admin-header h1 {
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .subscriptions-table {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .subscriptions-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .subscriptions-table th,
        .subscriptions-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .subscriptions-table th {
            background: rgba(255, 255, 255, 0.2);
            font-weight: bold;
        }
        
        .btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #8B4513, #D2691E);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-1px);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">
        <i class="fas fa-arrow-left"></i> 返回首页
    </a>
    
    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-chart-bar"></i> 预约管理后台</h1>
            <p>查看和管理所有预约信息</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div>总预约数</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayCount">0</div>
                <div>今日预约</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="thisWeekCount">0</div>
                <div>本周预约</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="thisMonthCount">0</div>
                <div>本月预约</div>
            </div>
        </div>
        
        <div class="subscriptions-table">
            <table id="subscriptionsTable">
                <thead>
                    <tr>
                        <th>时间</th>
                        <th>姓名</th>
                        <th>邮箱</th>
                        <th>电话</th>
                        <th>兴趣</th>
                        <th>留言</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="subscriptionsList">
                    <!-- 数据将通过JavaScript填充 -->
                </tbody>
            </table>
        </div>
        
        <div id="emptyState" class="empty-state" style="display: none;">
            <i class="fas fa-inbox" style="font-size: 3em; margin-bottom: 10px;"></i>
            <h3>暂无预约数据</h3>
            <p>等待用户提交预约信息...</p>
        </div>
    </div>

    <script>
        // 加载预约数据
        function loadSubscriptions() {
            // 从localStorage加载数据（演示用）
            const subscriptions = JSON.parse(localStorage.getItem('subscriptions') || '[]');
            
            // 更新统计信息
            updateStats(subscriptions);
            
            // 更新表格
            updateTable(subscriptions);
        }
        
        function updateStats(subscriptions) {
            const total = subscriptions.length;
            const today = subscriptions.filter(s => {
                const date = new Date(s.timestamp);
                const now = new Date();
                return date.toDateString() === now.toDateString();
            }).length;
            
            const thisWeek = subscriptions.filter(s => {
                const date = new Date(s.timestamp);
                const now = new Date();
                const weekStart = new Date(now.setDate(now.getDate() - now.getDay()));
                return date >= weekStart;
            }).length;
            
            const thisMonth = subscriptions.filter(s => {
                const date = new Date(s.timestamp);
                const now = new Date();
                return date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear();
            }).length;
            
            document.getElementById('totalCount').textContent = total;
            document.getElementById('todayCount').textContent = today;
            document.getElementById('thisWeekCount').textContent = thisWeek;
            document.getElementById('thisMonthCount').textContent = thisMonth;
        }
        
        function updateTable(subscriptions) {
            const tbody = document.getElementById('subscriptionsList');
            const emptyState = document.getElementById('emptyState');
            
            if (subscriptions.length === 0) {
                document.querySelector('.subscriptions-table').style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            document.querySelector('.subscriptions-table').style.display = 'block';
            emptyState.style.display = 'none';
            
            tbody.innerHTML = subscriptions.map((sub, index) => `
                <tr>
                    <td>${sub.timestamp}</td>
                    <td>${sub.name}</td>
                    <td>${sub.email}</td>
                    <td>${sub.phone}</td>
                    <td>${Array.isArray(sub.interests) ? sub.interests.join(', ') : sub.interests}</td>
                    <td>${sub.message || '-'}</td>
                    <td>
                        <button class="btn" onclick="deleteSubscription(${index})">
                            <i class="fas fa-trash"></i> 删除
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        function deleteSubscription(index) {
            if (confirm('确定要删除这条预约记录吗？')) {
                const subscriptions = JSON.parse(localStorage.getItem('subscriptions') || '[]');
                subscriptions.splice(index, 1);
                localStorage.setItem('subscriptions', JSON.stringify(subscriptions));
                loadSubscriptions();
            }
        }
        
        function exportData() {
            const subscriptions = JSON.parse(localStorage.getItem('subscriptions') || '[]');
            if (subscriptions.length === 0) {
                alert('暂无数据可导出');
                return;
            }
            
            const csvContent = [
                ['时间', '姓名', '邮箱', '电话', '兴趣', '留言'],
                ...subscriptions.map(s => [
                    s.timestamp,
                    s.name,
                    s.email,
                    s.phone,
                    Array.isArray(s.interests) ? s.interests.join('; ') : s.interests,
                    s.message || ''
                ])
            ].map(row => row.map(field => `"${field}"`).join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `subscriptions_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
        
        // 添加导出按钮
        const exportBtn = document.createElement('button');
        exportBtn.innerHTML = '<i class="fas fa-download"></i> 导出CSV';
        exportBtn.className = 'btn';
        exportBtn.onclick = exportData;
        document.querySelector('.admin-header').appendChild(exportBtn);
        
        // 页面加载时初始化
        loadSubscriptions();
        
        // 每30秒自动刷新数据
        setInterval(loadSubscriptions, 30000);
    </script>
</body>
</html>